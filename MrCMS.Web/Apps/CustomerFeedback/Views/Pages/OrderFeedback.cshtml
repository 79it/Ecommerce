@using MrCMS.Web.Apps.CustomerFeedback.Entities
@model MrCMS.Web.Apps.CustomerFeedback.Pages.OrderFeedback
@{
    var feedbackRecord = ViewData["model"] as FeedbackRecord ?? new FeedbackRecord();
}
<h1>@Model.Name</h1>
@Html.Raw(Model.BodyContent)

@if (feedbackRecord.IsCompleted)
{
    <div class="alert alert-success" role="alert">
        @Resource("Order Feedback Submitted - Success", "Order Feedback Submitted.")
    </div>
}
else
{
    <div class="row">
        <div class="col-xs-12">
            <ul class="list-unstyled">
                <li><strong>Id:</strong> #@feedbackRecord.Order.Id</li>
                <li><strong>Order Date:</strong> @feedbackRecord.Order.OrderDate</li>
            </ul>

            @using (Html.BeginForm("Submit", "OrderFeedback", FormMethod.Post))
            {
                @Html.Hidden("OrderGuid", feedbackRecord.Order.Guid)

                if (feedbackRecord.FeedbackFacetRecords.Any())
                {
                    foreach (FeedbackFacetRecord feedbackFacetRecord in feedbackRecord.FeedbackFacetRecords.ToList())
                    {
                        <h3>@feedbackFacetRecord.FeedbackFacet.Name</h3>
                        @OptionHtml(feedbackFacetRecord.Id)
                    }
                }

                if (feedbackRecord.ProductVariantFeedbackRecords.Any())
                {
                    <h2>Product Feedback</h2>
                    foreach (ProductVariantFeedbackRecord productVariantFeedbackRecord in feedbackRecord.ProductVariantFeedbackRecords.ToList())
                    {
                        <h3>@productVariantFeedbackRecord.ProductVariant.Name</h3>
                        @OptionHtml(productVariantFeedbackRecord.Id)
                    }
                }
                <button type="submit" class="btn btn-primary">@Resource("Submit")</button>
            }
        </div>
    </div>
}


@helper OptionHtml(int id)
{
    <div class="form-group">
        @Html.Label("Rating-" + id, "Rating")
        <span class="field-validation-valid" data-valmsg-for="Rating-@id" data-valmsg-replace="true"></span>
        <select class="form-control" id="Rating-@id" name="Rating-@id" data-val="true" data-val-required="A rating is required">
            <option value="">@Resource("Select a rating")</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
        </select>
    </div>
    <div class="form-group">
        @Html.Label("Message-" + id, "Message")
        @Html.TextArea("Message-" + id, new { @class = "form-control", rows = 5 })
    </div>
}